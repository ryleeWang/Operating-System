# 进程/线程

## 进程

进程指一个具有一定独立功能的**程序**在一个**数据集**上的**动态执行过程**。进程包含了正在运行的一个程序的所有状态信息，是系统进行资源分配和调度的基本单位。**进程是资源分配的最小单位。**

### **进程的状态及转换**

**进程状态：**

* **创建（new）**：进程正在被创建，尚未到就绪状态。
* **就绪（ready）**：进程已处于准备运行状态，即进程获得了除了处理器之外的一切所需资源，一旦得到处理器资源（处理器分配的时间片）即可运行。
* **运行（running）**：进程正在CPU上运行（单核CPU下任意时刻只有一个进程处于运行状态）。
* **阻塞（waiting）**：又称为等待状态，进程正在等待某一事件而暂停运行如等待某资源为可用或等待 IO 操作完成。即使处理器空闲，该进程也不能运行。
* **结束（terminated）**：进程正在从系统中消失。可能是进程正常结束或其他原因中断退出运行。
* **就绪挂起（suspend ready）**：驻留在外存的就绪状态。
* **阻塞挂起（suspend waiting）**：驻留在外存的阻塞状态。

![&#x8FDB;&#x7A0B;&#x72B6;&#x6001;&#x53CA;&#x76F8;&#x4E92;&#x8F6C;&#x6362;&#x7684;&#x6761;&#x4EF6;](.gitbook/assets/cao-zuo-xi-tong-jin-cheng-zhuang-tai%20%281%29.png)

**状态转换条件：**

1. 接收：
2. 接收：
3. 调度：
4. 时间片完：
5. 等待事件：
6. 挂起：
7. 事件发生：
8. 挂起：
9. 激活：
10. 事件发生：
11. 挂起：
12. 激活：
13. 结束：

### 进程间通信

1. 管道/匿名管道（Pipes）
2. 有名管道（Names Pipes）
3. 信号（Signal）
4. 消息队列（Message Queuing）
5. 信号量（Semaphores）
6. 共享内存（Shared memory）
7. 套接字（Sockets）

### 进程调度算法

1. 先来先服务（FCFS）
2. 短进程优先（SJF）
3. 时间片轮转（Round robin）
4. 多级反馈队列（Multilevel feedback queues）
5. 优先级调度
6. 最高响应比优先
7. 公平共享调度

**先来先服务（FCFS）**：从就绪队列中选择一个最先进入该队列的进程为之分配资源，使它立即执行并**一直执行到完成**或发生某事件而被**阻塞**放弃占用CPU时再重新调度。

**短进程优先（SJF）**：从就绪队列中选出一个估计运行时间最短的进程为之分配资源，使它立即执行并**一直执行到完成**或发生某事件而被**阻塞**放弃占用CPU时再重新调度。

**时间片轮转（Round robin）**：每个进程被分配一个时间段，称作它的时间片，即该进程允许运行的时间。

**多级反馈队列（Multilevel feedback queues）**：设置多个就绪队列，每个就绪队列具有不同的优先级以及不同的时间片，新的就绪进程到来时，首先被添加到优先级最高的就绪队列尾，较高优先级队列中的进程在运行完设定的时间片后若还没结束，会被从高优先级队列中取出，添加到下一级较低优先级的队列尾。特点：

* 队列优先级越高，设定的时间片越短
* 同一队列中的进程遵循先来先服务原则
* 进程在进入待调度的队列等待时，首先进入优先级最高的队列等待
* 只有高优先级队列都没有进程时，才会运行当前次优先级队列中的进程
* 当高优先级队列有新进程时，会抢占当前运行的低优先级队列中的进程的CPU资源

## 线程

### 线程间同步

1. 互斥量（Mutex）
2. 信号量（Semaphores）
3. 事件（Event）

## 进程 & 程序的关系

一个应用程序（application）通常由多个程序（program）组成，一个进程（process）只对应一个正在执行的程序（program），进而一个程序同时执行几次就对应几个进程。

* 进程是操作系统处理执行状态程序的抽象
* 程序是静态文件，进程是程序 + 执行状态
* 进程是暂时的，程序是永久的
* 同一个程序多次执行对应不同的进程
* 进程执行不仅需要程序文件，还需要内存资源保存代码和数据、CPU资源执行指令

## 进程 & 线程的关系/区别

* 进程是资源分配的基本单位，线程是处理机调度的基本单位
* 进程至少有一个线程，在多线程OS中，进程不是一个可执行的实体，而是线程的容器
* 不同进程的地址空间和资源相互独立，同一进程中的所有线程共享进程的资源
* 线程创建时间和结束时间短，同一进程内的线程间的切换时间短
* 由于同一进程内的线程共享内存和文件资源，所有可以不通过内核直接通信

## 多进程 & 多线程的比较

多进程允许多个任务同时执行，多线程允许单个任务分成不同部分执行。

* 数据共享：多进程复杂，多线程简单
* 数据同步：多进程简单，多线程复杂
* 内存占用：多进程多，多线程少
* CPU利用率：多进程高，多线程低
* 创建/销毁/切换：多进程慢，多线程快
* 编程/调试：多进程简单，多线程难
* 可靠性：进程间不会互相影响，但任何一个线程崩溃会导致整个进程崩溃
* 分布式：多进程适应多核、多机分布式，多线程适应多核分布式

